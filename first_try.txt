ansible-playbook playbooks/site.yml -i inventory.yml 

PLAY [Cluster prep] *************************************************************************************************************************************************************************

TASK [Gathering Facts] **********************************************************************************************************************************************************************
[WARNING]: Platform linux on host 160.85.30.104 is using the discovered Python interpreter at /usr/bin/python3.10, but future installation of another Python interpreter could change the
meaning of that path. See https://docs.ansible.com/ansible-core/2.17/reference_appendices/interpreter_discovery.html for more information.
ok: [160.85.30.104]
[WARNING]: Platform linux on host 160.85.30.106 is using the discovered Python interpreter at /usr/bin/python3.10, but future installation of another Python interpreter could change the
meaning of that path. See https://docs.ansible.com/ansible-core/2.17/reference_appendices/interpreter_discovery.html for more information.
ok: [160.85.30.106]
[WARNING]: Platform linux on host 160.85.30.105 is using the discovered Python interpreter at /usr/bin/python3.10, but future installation of another Python interpreter could change the
meaning of that path. See https://docs.ansible.com/ansible-core/2.17/reference_appendices/interpreter_discovery.html for more information.
ok: [160.85.30.105]

TASK [prereq : Enforce minimum Ansible version] *********************************************************************************************************************************************
ok: [160.85.30.104] => {
    "changed": false,
    "msg": "All assertions passed"
}
ok: [160.85.30.105] => {
    "changed": false,
    "msg": "All assertions passed"
}
ok: [160.85.30.106] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [prereq : Install Dependent Ubuntu Packages] *******************************************************************************************************************************************
changed: [160.85.30.106]
changed: [160.85.30.105]
changed: [160.85.30.104]

TASK [prereq : Enable IPv4 forwarding] ******************************************************************************************************************************************************
changed: [160.85.30.105]
changed: [160.85.30.104]
changed: [160.85.30.106]

TASK [prereq : Enable IPv6 forwarding] ******************************************************************************************************************************************************
changed: [160.85.30.105]
changed: [160.85.30.104]
changed: [160.85.30.106]

TASK [prereq : Populate service facts] ******************************************************************************************************************************************************
ok: [160.85.30.104]
ok: [160.85.30.106]
ok: [160.85.30.105]

TASK [prereq : Get ufw status] **************************************************************************************************************************************************************
ok: [160.85.30.104]
ok: [160.85.30.106]
ok: [160.85.30.105]

TASK [prereq : If ufw enabled, open api port] ***********************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : If ufw enabled, open etcd ports] *********************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : If ufw enabled, allow default CIDRs] *****************************************************************************************************************************************
skipping: [160.85.30.104] => (item=10.42.0.0/16) 
skipping: [160.85.30.104] => (item=10.43.0.0/16) 
skipping: [160.85.30.104]
skipping: [160.85.30.105] => (item=10.42.0.0/16) 
skipping: [160.85.30.105] => (item=10.43.0.0/16) 
skipping: [160.85.30.105]
skipping: [160.85.30.106] => (item=10.42.0.0/16) 
skipping: [160.85.30.106] => (item=10.43.0.0/16) 
skipping: [160.85.30.106]

TASK [prereq : If firewalld enabled, open api port] *****************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : If firewalld enabled, open etcd ports] ***************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : If firewalld enabled, open inter-node ports] *********************************************************************************************************************************
skipping: [160.85.30.104] => (item=5001/tcp) 
skipping: [160.85.30.104] => (item=8472/udp) 
skipping: [160.85.30.104] => (item=10250/tcp) 
skipping: [160.85.30.105] => (item=5001/tcp) 
skipping: [160.85.30.104] => (item=51820/udp) 
skipping: [160.85.30.105] => (item=8472/udp) 
skipping: [160.85.30.104] => (item=51821/udp) 
skipping: [160.85.30.104]
skipping: [160.85.30.105] => (item=10250/tcp) 
skipping: [160.85.30.106] => (item=5001/tcp) 
skipping: [160.85.30.105] => (item=51820/udp) 
skipping: [160.85.30.106] => (item=8472/udp) 
skipping: [160.85.30.105] => (item=51821/udp) 
skipping: [160.85.30.105]
skipping: [160.85.30.106] => (item=10250/tcp) 
skipping: [160.85.30.106] => (item=51820/udp) 
skipping: [160.85.30.106] => (item=51821/udp) 
skipping: [160.85.30.106]

TASK [prereq : If firewalld enabled, allow node CIDRs] **************************************************************************************************************************************
skipping: [160.85.30.104] => (item=160.85.30.104) 
skipping: [160.85.30.104] => (item=160.85.30.105) 
skipping: [160.85.30.104] => (item=160.85.30.106) 
skipping: [160.85.30.105] => (item=160.85.30.104) 
skipping: [160.85.30.104]
skipping: [160.85.30.105] => (item=160.85.30.105) 
skipping: [160.85.30.106] => (item=160.85.30.104) 
skipping: [160.85.30.105] => (item=160.85.30.106) 
skipping: [160.85.30.105]
skipping: [160.85.30.106] => (item=160.85.30.105) 
skipping: [160.85.30.106] => (item=160.85.30.106) 
skipping: [160.85.30.106]

TASK [prereq : If firewalld enabled, allow default CIDRs] ***********************************************************************************************************************************
skipping: [160.85.30.104] => (item=10.42.0.0/16) 
skipping: [160.85.30.104] => (item=10.43.0.0/16) 
skipping: [160.85.30.104]
skipping: [160.85.30.105] => (item=10.42.0.0/16) 
skipping: [160.85.30.105] => (item=10.43.0.0/16) 
skipping: [160.85.30.105]
skipping: [160.85.30.106] => (item=10.42.0.0/16) 
skipping: [160.85.30.106] => (item=10.43.0.0/16) 
skipping: [160.85.30.106]

TASK [prereq : Add br_netfilter to /etc/modules-load.d/] ************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : Load br_netfilter] ***********************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : Set bridge-nf-call-iptables (just to be sure)] *******************************************************************************************************************************
skipping: [160.85.30.104] => (item=net.bridge.bridge-nf-call-iptables) 
skipping: [160.85.30.104] => (item=net.bridge.bridge-nf-call-ip6tables) 
skipping: [160.85.30.104]
skipping: [160.85.30.105] => (item=net.bridge.bridge-nf-call-iptables) 
skipping: [160.85.30.105] => (item=net.bridge.bridge-nf-call-ip6tables) 
skipping: [160.85.30.105]
skipping: [160.85.30.106] => (item=net.bridge.bridge-nf-call-iptables) 
skipping: [160.85.30.106] => (item=net.bridge.bridge-nf-call-ip6tables) 
skipping: [160.85.30.106]

TASK [prereq : Check for Apparmor existence] ************************************************************************************************************************************************
ok: [160.85.30.104]
ok: [160.85.30.105]
ok: [160.85.30.106]

TASK [prereq : Check if Apparmor is enabled] ************************************************************************************************************************************************
ok: [160.85.30.104]
ok: [160.85.30.105]
ok: [160.85.30.106]

TASK [prereq : Install Apparmor Parser [Suse]] **********************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : Install Apparmor Parser [Debian]] ********************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : Gather the package facts] ****************************************************************************************************************************************************
ok: [160.85.30.106]
ok: [160.85.30.104]
ok: [160.85.30.105]

TASK [prereq : If iptables v1.8.0-1.8.4, warn user] *****************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : Add /usr/local/bin to sudo secure_path] **************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : Make rancher directory] ******************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : Create symlink] **************************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : Make manifests directory] ****************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : Copy manifests] **************************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : Make k3s config directory] ***************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [prereq : Copy config values] **********************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Verify Ansible meets airgap version requirements.] ***************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Check for existing install script] *******************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Download k3s install script] *************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Distribute K3s install script] ***********************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Determine architecture and set k3s_arch] *************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Distribute K3s binary {{ k3s_arch }}] ****************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Distribute K3s SELinux RPM] **************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Install K3s SELinux RPM] *****************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Make images directory] *******************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Distribute K3s images {{ k3s_arch }}] ****************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Run K3s Install [server]] ****************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [airgap : Run K3s Install [agent]] *****************************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [raspberrypi : Test for raspberry pi /proc/cpuinfo] ************************************************************************************************************************************
ok: [160.85.30.104]
ok: [160.85.30.105]
ok: [160.85.30.106]

TASK [raspberrypi : Test for raspberry pi /proc/device-tree/model] **************************************************************************************************************************
ok: [160.85.30.105]
ok: [160.85.30.104]
ok: [160.85.30.106]

TASK [raspberrypi : Set raspberry_pi fact to true] ******************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [raspberrypi : Set detected_distribution to Raspbian] **********************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [raspberrypi : Set detected_distribution to Debian] ************************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [raspberrypi : Set detected_distribution to ArchLinux (ARM64)] *************************************************************************************************************************
skipping: [160.85.30.104]
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [raspberrypi : Execute OS related tasks on the Raspberry Pi] ***************************************************************************************************************************
skipping: [160.85.30.104] => (item=/home/caspar/Documents/git/k3s-ansible/roles/raspberrypi/tasks/prereq/Ubuntu.yml) 
skipping: [160.85.30.104]
skipping: [160.85.30.105] => (item=/home/caspar/Documents/git/k3s-ansible/roles/raspberrypi/tasks/prereq/Ubuntu.yml) 
skipping: [160.85.30.105]
skipping: [160.85.30.106] => (item=/home/caspar/Documents/git/k3s-ansible/roles/raspberrypi/tasks/prereq/Ubuntu.yml) 
skipping: [160.85.30.106]

PLAY [Setup K3S server] *********************************************************************************************************************************************************************

TASK [Gathering Facts] **********************************************************************************************************************************************************************
ok: [160.85.30.104]

TASK [k3s_server : Get k3s installed version] ***********************************************************************************************************************************************
fatal: [160.85.30.104]: FAILED! => {"changed": false, "cmd": "k3s --version", "msg": "[Errno 2] No such file or directory: b'k3s'", "rc": 2, "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
...ignoring

TASK [k3s_server : Set k3s installed version] ***********************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Download K3s install script] *********************************************************************************************************************************************
[WARNING]: Module remote_tmp /root/.ansible/tmp did not exist and was created with a mode of 0700, this may cause issues when running as another user. To avoid this, create the remote_tmp
dir with the correct permissions manually
changed: [160.85.30.104]

TASK [k3s_server : Download K3s binary] *****************************************************************************************************************************************************
changed: [160.85.30.104]

TASK [k3s_server : Add K3s autocomplete to user bashrc] *************************************************************************************************************************************
changed: [160.85.30.104]

TASK [k3s_server : Make config directory] ***************************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Copy config values] ******************************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Copy K3s service file [Single]] ******************************************************************************************************************************************
changed: [160.85.30.104]

TASK [k3s_server : Copy K3s service file [HA]] **********************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Add service environment variables] ***************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Delete any existing token from the environment if different from the new one] ********************************************************************************************
ok: [160.85.30.104]

TASK [k3s_server : Add token as an environment variable] ************************************************************************************************************************************
changed: [160.85.30.104]

TASK [k3s_server : Restart K3s service] *****************************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Enable and check K3s service] ********************************************************************************************************************************************
changed: [160.85.30.104]

TASK [k3s_server : Pause to allow first server startup] *************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Check whether kubectl is installed on control node] **********************************************************************************************************************
ok: [160.85.30.104 -> 127.0.0.1]

TASK [k3s_server : Copy k3s.yaml to second file] ********************************************************************************************************************************************
changed: [160.85.30.104]

TASK [k3s_server : Copy kubeconfig to control node] *****************************************************************************************************************************************
changed: [160.85.30.104]

TASK [k3s_server : Change server address in kubeconfig on control node] *********************************************************************************************************************
changed: [160.85.30.104 -> 127.0.0.1]

TASK [k3s_server : Setup kubeconfig context on control node - k3s-ansible] ******************************************************************************************************************
changed: [160.85.30.104 -> 127.0.0.1]

TASK [k3s_server : Merge with any existing kubeconfig on control node] **********************************************************************************************************************
changed: [160.85.30.104 -> 127.0.0.1]

TASK [k3s_server : Delete any existing token from the environment if different from the new one] ********************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Add the token for joining the cluster to the environment] ****************************************************************************************************************
skipping: [160.85.30.104] => (item=None) 
skipping: [160.85.30.104]

TASK [k3s_server : Copy K3s service file [HA]] **********************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Copy K3s service file [External DB]] *************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Restart K3s service] *****************************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Enable and check K3s service] ********************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Verify that all server nodes joined] *************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Create kubectl symlink] **************************************************************************************************************************************************
skipping: [160.85.30.104]

TASK [k3s_server : Create directory .kube] **************************************************************************************************************************************************
changed: [160.85.30.104]

TASK [k3s_server : Copy config file to user home directory] *********************************************************************************************************************************
changed: [160.85.30.104]

TASK [k3s_server : Configure default KUBECONFIG for user] ***********************************************************************************************************************************
changed: [160.85.30.104]

TASK [k3s_server : Configure kubectl autocomplete] ******************************************************************************************************************************************
changed: [160.85.30.104]

PLAY [Setup K3S agent] **********************************************************************************************************************************************************************

TASK [Gathering Facts] **********************************************************************************************************************************************************************
ok: [160.85.30.106]
ok: [160.85.30.105]

TASK [k3s_agent : Get k3s installed version] ************************************************************************************************************************************************
fatal: [160.85.30.106]: FAILED! => {"changed": false, "cmd": "k3s --version", "msg": "[Errno 2] No such file or directory: b'k3s'", "rc": 2, "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
...ignoring
fatal: [160.85.30.105]: FAILED! => {"changed": false, "cmd": "k3s --version", "msg": "[Errno 2] No such file or directory: b'k3s'", "rc": 2, "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
...ignoring

TASK [k3s_agent : Set k3s installed version] ************************************************************************************************************************************************
skipping: [160.85.30.105]
skipping: [160.85.30.106]

TASK [k3s_agent : Download K3s install script] **********************************************************************************************************************************************
changed: [160.85.30.106]
changed: [160.85.30.105]

TASK [k3s_agent : Download K3s binary] ******************************************************************************************************************************************************
changed: [160.85.30.105]
changed: [160.85.30.106]

TASK [k3s_agent : Delete any existing token from the environment if different from the new one] *********************************************************************************************
ok: [160.85.30.105]
ok: [160.85.30.106]

TASK [k3s_agent : Add the token for joining the cluster to the environment] *****************************************************************************************************************
changed: [160.85.30.105] => (item=None)
changed: [160.85.30.105]
changed: [160.85.30.106] => (item=None)
changed: [160.85.30.106]

TASK [k3s_agent : Copy K3s service file] ****************************************************************************************************************************************************
changed: [160.85.30.106]
changed: [160.85.30.105]

TASK [k3s_agent : Enable and check K3s service] *********************************************************************************************************************************************
changed: [160.85.30.106]
changed: [160.85.30.105]

PLAY RECAP **********************************************************************************************************************************************************************************
160.85.30.104              : ok=31   changed=18   unreachable=0    failed=0    skipped=53   rescued=0    ignored=1   
160.85.30.105              : ok=20   changed=8    unreachable=0    failed=0    skipped=39   rescued=0    ignored=1   
160.85.30.106              : ok=20   changed=8    unreachable=0    failed=0    skipped=39   rescued=0    ignored=1   
